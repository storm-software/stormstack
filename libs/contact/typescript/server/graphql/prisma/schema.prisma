datasource db {
    provider = "mongodb"
    url      = env("CONTACT_DB_CONNECTION_STRING")
}

generator client {
    provider = "prisma-client-js"
    // Generate into custom location because this repo has multiple prisma schemas
    output   = "../src/__generated__/prisma"
}

generator pothos {
    provider     = "prisma-pothos-types"
    // Match client output location from above
    clientOutput = "./prisma"
    prismaUtils  = true
    output       = "../src/__generated__/types.ts"
}

generator pothosCrud {
    provider            = "prisma-generator-pothos-codegen"
    generatorConfigPath = "../codegen.config.js"
}

generator zod {
    provider                         = "zod-prisma-types"
    output                           = "../src/__generated__/zod"
    useMultipleFiles                 = true // default is false
    writeBarrelFiles                 = true // default is true
    createInputTypes                 = true // default is true
    createModelTypes                 = false // default is true
    addInputTypeValidation           = true // default is true
    addIncludeType                   = true // default is true
    addSelectType                    = true // default is true
    validateWhereUniqueInput         = true // default is false
    createOptionalDefaultValuesTypes = true // default is false
    createRelationValuesTypes        = true // default is false
    createPartialTypes               = true // default is false
    useDefaultValidators             = true // default is true
    coerceDate                       = true // default is true
    writeNullishInModelTypes         = true // default is false
    prismaClientPath                 = "../prisma"
}

enum ContactReason {
    Business
    Question
    Other
    Project
    Interest
    Subscription
}

/// The data fields related to a specific Contact request instance
model Contact {
    /// The unique identifier for the Contact
    /// @Pothos.omit(create)
    id String @id @default(auto()) @map("_id") @db.ObjectId

    /// A timestamp of when the Contact was created
    /// @Pothos.omit(create, update)
    createdOn DateTime @default(now())

    /// The user who created the Contact
    /// @Pothos.omit(create, update)
    createdBy String @db.ObjectId

    /// A timestamp of when the Contact was last updated
    /// @Pothos.omit(create, update)
    updatedOn DateTime? @updatedAt

    /// The user who last updated the Contact
    /// @Pothos.omit(create, update)
    updatedBy String? @db.ObjectId

    /// The reason of the Contact
    reason ContactReason @default(Other)

    /// The details of the Contact
    details String?

    /// The provided email to respond back to the Contact request
    email String /// @zod.string.email()

    /// The provided phone number to respond back to the Contact request
    phoneNumber String? /// @zod.string.max(15)

    /// The provided first name of the Contact
    firstName String?

    /// The provided first name of the Contact
    lastName String?

    /// The provided address of the Contact
    addressLine1 String?

    /// The provided address of the Contact
    addressLine2 String?

    /// The provided postal code of the Contact
    postalCode String? /// @zod.string.min(5).max(12)

    /// The provided city of the Contact
    city String?

    /// The provided state of the Contact
    state String?

    /// The provided country code of the Contact
    countryCode String?

    /// The provided title of the Contact
    title String?

    /// The provided company name of the Contact
    companyName String?

    /// The provided URL of the Contact
    url String? /// @zod.string.url()

    /// A list of file attachments included by the Contact
    attachments ContactAttachment[]
}

enum AttachmentStatus {
    Pending
    Approved
    Rejected
    Removed
}

/// A file attachment included by a Contact
model ContactAttachment {
    /// The unique identifier for the ContactAttachment
    /// @Pothos.omit(create)
    id String @id @default(auto()) @map("_id") @db.ObjectId

    /// A timestamp of when the ContactAttachment was created
    /// @Pothos.omit(create, update)
    createdOn DateTime @default(now())

    /// The user who created the ContactAttachment
    /// @Pothos.omit(create, update)
    createdBy String @db.ObjectId

    /// A timestamp of when the ContactAttachment was last updated
    /// @Pothos.omit(create, update)
    updatedOn DateTime? @updatedAt

    /// The user who last updated the ContactAttachment
    /// @Pothos.omit(create, update)
    updatedBy String? @db.ObjectId

    /// The name of the file
    name String

    /// The path of the file
    path String

    /// The status of the file
    status AttachmentStatus @default(Pending)

    /// The Contact the attachment belongs to
    contact Contact @relation(fields: [contactId], references: [id])

    /// The Contact (Id) the attachment belongs to
    contactId String @db.ObjectId

    @@unique([name, path])
}
